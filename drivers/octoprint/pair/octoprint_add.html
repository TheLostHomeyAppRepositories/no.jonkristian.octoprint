<script type="text/javascript">
function configure() {
    let name = document.getElementById('name').value;
    let address = document.getElementById('address').value;
    let port = document.getElementById('port').value;
    let ssl = ( document.getElementById('ssl').checked ) ? 'on' : 'off';
    let apikey = document.getElementById('apikey').value;

    if ( undefined !== name || undefined !== address || undefined !== apikey ) {
        const settings = {
            name: name,
            address: address,
            port: port,
            ssl: ssl,
            apikey: apikey
        };

        Homey.emit('validate', settings, function (err, result) {
            if (err) {
                console.log(err);
                Homey.alert(err.message, 'error');
            } else {
                const device = {
                    name: name,
                    data: {
                        id: name+'_'+address
                    },
                    settings: {
                        address: address,
                        port: port,
                        ssl: ssl,
                        apikey: apikey
                    }
                };
                Homey.createDevice(device, function (err, result) {
                    if (err) return Homey.alert(err);
                    Homey.alert(__('pair.success'), 'info');
                    Homey.done();
                });
            }
        });
    } else {
        Homey.alert(__('pair.required'), 'error');
    }
}
</script>

<fieldset>
    <legend data-i18n="pair.legend"></legend>
    <div class="field row">
        <label for="name" data-i18n="pair.name"></label>
        <input type="text" id="name"></input>
    </div>
    <div class="field row">
        <label for="address" data-i18n="pair.address"></label>
        <input type="text" id="address"></input>
    </div>
    <div class="field row">
        <label for="port" data-i18n="pair.port"></label>
        <input type="text" id="port" value="80"></input>
    </div>
    <div class="field row">
        <label for="ssl" data-i18n="pair.ssl"></label>
        <input type="checkbox" id="ssl"></input>
    </div>
    <div class="field row">
        <label for="apikey" data-i18n="pair.apikey"></label>
        <input type="text" id="apikey"></input>
    </div>
</fieldset>

<button class="right" id="save" onclick="configure();" data-i18n="pair.save">